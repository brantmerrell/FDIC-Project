# ...return vector of squares}
# no pawn is on e5, e1, or e8:
pawnPost.("e5",game_pgn="000_zero") # [1] "e6" "e4"
# e5 is occupied by neither color, so e5 pawn is neither color, which is impossible.
# Function assumes this impossible pawn can move both directions.
pawnPost.("e1", game_pgn="000_zero") # [1] NA
# e1 is occupied by the white king. pawnPost recognizes e1 as white, but assumes the
# occupant is a pawn. A pawn in the king's place at this position would be unable to move.
queenPath2<-function(square,game_pgn){
R<-rookPost.(square,game_pgn)
B<-bishopPost.(square,game_pgn)
sort(c(R,B))
}
kingPath2<-function(square,game_pgn){
Col<-which(letters==strsplit(square,"")[[1]][1]) # identify the column
Row<-as.numeric(strsplit(square,"")[[1]][2]) # identify the row
KRange<-function(center=5){
K<-(center-1):(center+1)
K[0<K & K<=8]
}
Path<-expand.grid(letters[KRange(Col)],KRange(Row))
Path<-paste(Path[,1],Path[,2],sep="")
Path[Path!=square]
Test<-function(toSquare,fromSquare=square){
fromColor<-squareColor(fromSquare,game_pgn)
if(!is.na(fromColor)){
if(fromColor==whitePattern){colorPattern<-blackPattern}
if(fromColor==blackPattern){colorPattern<-whitePattern}
}else{colorPattern<-blackPattern}
toColor<-squareColor(toSquare,game_pgn)
grepl(colorPattern,position[game_pgn,toSquare]) |
is.na(position[game_pgn,toSquare])
}
Path<-Path[unlist(lapply(Path,Test))]
Path[Path!=square]
}
CSTL<-function(X){
if(grepl("O-O",X)){
kingColumn<-"g"
rookColumn<-"f"
rookVacant<-"h"
}else{
kingColumn<-"c"
rookColumn<-"d"
rookVacant<-"a"
}
if(grepl(blackPattern,X)){
Row<-8
}
if(grepl(whitePattern,X)){
Row<-1
}
list(king=paste(kingColumn,Row,sep=""),
rook=paste(rookColumn,Row,sep=""),
kingVacant=paste("e",Row,sep=""),
rookVacant=paste(rookVacant,Row,sep=""))
}
piecePath2<-function(square,game_pgn){
piece<-as.vector(position[game_pgn,square])
if(grepl(pawnPattern,piece)){return(pawnPost.(square,game_pgn))}
if(grepl(knightPattern,piece)){return(paste("",knightPost.(square,game_pgn),sep=""))}
if(grepl(bishopPattern,piece)){return(paste("",bishopPost.(square,game_pgn),sep=""))}
if(grepl(rookPattern,piece)){return(paste("",rookPost.(square,game_pgn),sep=""))}
if(grepl(queenPattern,piece)){return(paste("",queenPath2(square,game_pgn),sep=""))}
if(grepl(kingPattern,piece)){return(paste("",kingPath2(square,game_pgn),sep=""))}
}
newPosition<-function(new_pgn="C1600W_1.e3",startPosition=nrow(position)){
castle<-grepl(castlePattern,new_pgn)
color<-ifelse(grepl(blackPattern,new_pgn),"black","white")
move<-as.numeric(strsplit(new_pgn,"\\.|_")[[1]][2])
if(!castle){
piece<-paste(color,pgnpiece(new_pgn))
endSquare<-strsplit(new_pgn,"")[[1]]
endSquare<-paste(endSquare[(length(endSquare)-1):length(endSquare)],collapse="")
FUN<-function(square){
piecePath2(square=square,game_pgn=startPosition)
}
workFrame<-pieceCount(nrow(position))
workFrame<-workFrame[grepl(color,workFrame$piece),]
workFrame<-workFrame[grepl(piece,workFrame$piece),]
workList<-lapply(as.character(workFrame$square), FUN)
names(workList)<-as.character(workFrame$square)
TEST<-function(n){endSquare %in% workList[[n]]}
startSquare<-names(workList)[[which(unlist(lapply(1:length(workList),TEST)))]]
newPosition<-position[startPosition,]
row.names(newPosition)<-new_pgn
newPosition[,startSquare]<-NA
newPosition[,endSquare]<-piece
}else{
piece<-paste(kingPattern,rookPattern,sep="|")
endSquare<-unlist(CSTL(new_pgn)[c("king","rook")])
startSquare<-unlist(CSTL(new_pgn)[c("kingVacant","rookVacant")])
newPosition<-position[startPosition,]
row.names(newPosition)<-new_pgn
newPosition[,startSquare]<-NA
newPosition[,endSquare]<-paste(color,names(endSquare))
}
newPosition
}
pgnpiece<-function(pgn){
test<-function(L){grepl(L,pgn)}
P<-c("K","Q","R","N","B")
Piece=c("King","Queen","Rook","Knight","Bishop")
df<-data.frame(P=P, Piece=Piece,assess=unlist(lapply(P,test)))
if(sum(df$assess)==0){
return("pawn")
}
if(sum(df$assess)==1){
return(as.character(subset(df$Piece,df$assess==TRUE)))
}
if(1<sum(df$assess)){
stop("Input contains extra piece")
}
}
mobility1<-function(game_pgn){
DF<-cbind(pieceCount(game_pgn),options="",count=NA)
class(DF$options)<-"character"
for(n in 1:nrow(DF)){
options1<-piecePath2(as.character(DF$square[n]),game_pgn)
DF[n,"options"]<-paste(options1,collapse=" ")
DF[n,"count"]<-ifelse(grepl(".\\d",DF[n,"options"]),length(options1),0)
}
DF
#   workList<-lapply(as.character(DF$square),piecePath2,game_pgn=game_pgn)
#   for(n in 1:length(workList)){workList[[n]]<-paste(workList[[n]],collapse=" ")}
#   names(workList)<-as.character(DF$piece)
#   head(workList)
}
mobility2<-function(game_pgn=2,piecePattern=""){
DF<-mobility1(game_pgn)
DF<-DF[grepl(piecePattern,DF$piece),]
if(class(game_pgn) %in% c("numeric", "integer")){game_pgn<-row.names(position)[game_pgn]}
data.frame(white=sum(DF[grepl(whitePattern,DF[,"piece"]),"count"]),
black=sum(DF[grepl(blackPattern,DF[,"piece"]),"count"]),
row.names=game_pgn)
}
position<-rbind(position,newPosition("C1600W_1.e3",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_1...d5",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_2.Qh5",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_2...Nf6",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_3.Qh4",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_3...Qd6",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_4.Nc3",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_4...e5",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_5.Nf3",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_5...Nc6",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_6.Bb5",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_6...Bd7",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_7.b3",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_7...Nb4",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_8.Bd3",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_8...Be7",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_9.Ba3",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_9...Nxd3",nrow(position))); mobility2(nrow(position)-0) # "+" returns error
position<-rbind(position,newPosition("C1600W_10.cxd3",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_10...Qxa3",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_11.Nxe5",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_11...Be6",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_12.Nb5",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_12...Qc5",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_13.Qa4",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_13...O-O",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_14.Ke2",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_14...Qb6",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_15.Nc3",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_15...Qd6",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_16.Qd4",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_16...c5",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_17.Qf4",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_17...Nh5",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_18.Qa4",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_18...Qxe5",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_19.g4",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_19...Nf6",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_20.h3",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_20...d4",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_21.f4",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_21...Qb8",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_22.Ne4",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_22...b5",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_23.Qa3",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_23...Qb7",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_24.Nxc5",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_24...Qg2",nrow(position))); mobility2(nrow(position)) # "+" returns error
position<-rbind(position,newPosition("C1600W_25.Kd1",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_25...Qxh1",nrow(position))); mobility2(nrow(position)) # "+" returns error
position<-rbind(position,newPosition("C1600W_26.Kc2",nrow(position))); mobility2(nrow(position))
position<-rbind(position,newPosition("C1600W_26...Qxa1",nrow(position))); mobility2(nrow(position))
paste(Sys.Date(),"C1600W.csv")
gameName<-paste(Sys.Date(),"e121236870")
gameName<-"e121236870"
position<-setup()
quickInput(".e4")
quickInput<-function(pgn=".e3"){
lastRow<-row.names(position)[nrow(position)]
# lastRow<-"C1600W_26...Qxa1"
if(grepl("zero",lastRow)){move<-1}else{
move<-strsplit(lastRow,"_|\\.")[[1]]
move<-as.numeric(move[grepl("^\\d+$",move)])
if(grepl(blackPattern,lastRow)){
move<-move+1
}
}
newRow<-paste(gameName,"_",move,pgn,sep="")
position<-rbind(position,newPosition(newRow,nrow(position)));
print(mobility2(newRow))
}
quickInput(".e4")
pgn=".e4"
lastRow<-row.names(position)[nrow(position)]
lastRow
if(grepl("zero",lastRow)){move<-1}else{
move<-strsplit(lastRow,"_|\\.")[[1]]
move<-as.numeric(move[grepl("^\\d+$",move)])
if(grepl(blackPattern,lastRow)){
move<-move+1
}
}
newRow
newRow<-paste(gameName,"_",move,pgn,sep="")
newRow
position<-rbind(position,newPosition(newRow,nrow(position)));
position
newRow
mobility2(newRow)
position<-setup()
gameName<-"e121236870"
quickInput<-function(pgn){
lastRow<-row.names(position)[nrow(position)]
# lastRow<-"C1600W_26...Qxa1"
if(grepl("zero",lastRow)){move<-1}else{
move<-strsplit(lastRow,"_|\\.")[[1]]
move<-as.numeric(move[grepl("^\\d+$",move)])
if(grepl(blackPattern,lastRow)){
move<-move+1
}
}
newRow<-paste(gameName,"_",move,pgn,sep="")
position<-rbind(position,newPosition(newRow,nrow(position)));
print(mobility2(newRow))
return(position)
}
quickInput(".e4")
mobility1(2)
quickInput<-function(pgn){
lastRow<-row.names(position)[nrow(position)]
# lastRow<-"C1600W_26...Qxa1"
if(grepl("zero",lastRow)){move<-1}else{
move<-strsplit(lastRow,"_|\\.")[[1]]
move<-as.numeric(move[grepl("^\\d+$",move)])
if(grepl(blackPattern,lastRow)){
move<-move+1
}
}
newRow<-paste(gameName,"_",move,pgn,sep="")
position<-rbind(position,newPosition(newRow,nrow(position)));
return(position)
}
quickInput(".e4")
position<-quickInput(".e4"); mobility2(nrow(position))
position<-quickInput(
"...e5"
); mobility2(nrow(position))
position<-quickInput(
".d4"
); mobility2(nrow(position))
position<-quickInput(
"exd4"); mobility2(nrow(position))
rownames(position)
"...exd4"); mobility2(nrow(position))
position<-quickInput(
"...exd4"); mobility2(nrow(position))
position<-quickInput(
".Qxd4"); mobility2(nrow(position))
position<-quickInput(
".Nc6"); mobility2(nrow(position))
position<-quickInput(
"...Nc6"); mobility2(nrow(position))
position<-quickInput(
".Qe3"); mobility2(nrow(position))
position<-quickInput(
"...Be7"); mobility2(nrow(position))
position<-quickInput(
".Nc3"); mobility2(nrow(position))
position<-quickInput(
"...d6"); mobility2(nrow(position))
position<-quickInput(
".Qg3"); mobility2(nrow(position))
position<-quickInput(
"...g6"); mobility2(nrow(position))
position<-quickInput(
".h4"); mobility2(nrow(position))
position<-quickInput(
"...Nf6"); mobility2(nrow(position))
mobility2
mobility1
quickInput(".Nh3")
tail(quickInput(".Nh3"),1)
mobility2
position<-quickInput(".Nh3"); mobility2(nrow(position)); position<-position[-nrow(position),]
position<-quickInput(".Nh3"); mobility2(nrow(position)); position<-position[-nrow(position),]
mobility2(nrow(position));
position<-quickInput(".Bd3"); mobility2(nrow(position)); position<-position[-nrow(position),]
position<-quickInput(".Bc4"); mobility2(nrow(position)); position<-position[-nrow(position),]
position<-quickInput(".Bb5"); mobility2(nrow(position)); position<-position[-nrow(position),]
position<-quickInput(".Be3"); mobility2(nrow(position)); position<-position[-nrow(position),]
mobility2(nrow(position))
position<-quickInput(".Bh6"); mobility2(nrow(position)); position<-position[-nrow(position),]
position<-quickInput(".Bg5"); mobility2(nrow(position)); position<-position[-nrow(position),]
position<-quickInput(".Nf3"); mobility2(nrow(position)); position<-position[-nrow(position),]
position<-quickInput(".Be4"); mobility2(nrow(position)); position<-position[-nrow(position),]
position<-quickInput(".Bc4"); mobility2(nrow(position)); position<-position[-nrow(position),]
position<-quickInput(".Be3"); mobility2(nrow(position)); position<-position[-nrow(position),]
position<-quickInput(".Be3"); mobility2(nrow(position))
position<-quickInput("...Ng4"); mobility2(nrow(position))
position<-quickInput(".Bc4"); mobility2(nrow(position))
args(selectizeInput)
library(shiny)
args(selectizeInput)
c(.17,.12,.06)
.17-sum(c(,.12,.06))
0.17-sum(c(,.12,.06))
0.17-sum(c(.12,.06))
getwd()
setwd("Josh/FDIC-Project")
list.files()
rm(list=ls())
load(".RData")
colNames<-lapply(list.files("modified",full.names = T),read.csv,nrows=3)
colNames<-lapply(colNames,colnames)
head(colNames)
unlist(lapply(colNames,length))
nCol<-unlist(lapply(colNames,length))
unique(nCol)
summary(nCol)
rm(colNames,nCol)
runApp()
FILES<-list.files("modified")
FILES<-strsplit(FILES,"_")
FILES<-list.files("modified")
quarters<-strsplit(FILES,"_")
quarters<-unlist(quarters)
quarters<-unique(quarters[grep("^\\d{8}$",quarters)])
quarters<-sort(unique(quarters[grep("^\\d{8}$",quarters)]))
head(quarters)
runApp
runApp()
runApp()
quarters<-expand.grid(1994:2014,1:4)
quarters<-sort(paste(quarters[,1],quarters[,2],sep="_"))
quarters
FILES<-list.files("modified")
quarters<-strsplit(FILES,"_")
quarters<-unlist(quarters)
quarters<-sort(unique(quarters[grep("^\\d{8}$",quarters)]))
qPattern
qPattern<-quarters[1]
list.files("modified",qPattern)
quarters<-expand.grid(1992:2014,1:4)
quarters<-sort(paste(quarters[,1],quarters[,2],sep="_"))
qPattern<-quarters[1]
qPattern<-strsplit(qPattern,"_")[[1]]
qPattern[2]<-c("0331","0630","0930","1231")[as.numeric(qPattern[2])]
qPattern<-paste(qPattern,collapse = "")
list.files("modified",qPattern)
length(list.files("modified",qPattern))
0<length(list.files("modified",qPattern))
quarters<-expand.grid(1992:2014,1:4)
quarters<-sort(paste(quarters[,1],quarters[,2],sep="_"))
quarters<-quarters["1992_4"<=quarters]
runApp()
subDF<-quarterData(qPattern)
qPattern
qPattern<-quarters[1]
qPattern
qPattern<-strsplit(qPattern,"_")[[1]]
qPattern[2]<-c("0331","0630","0930","1231")[as.numeric(qPattern[2])]
qPattern<-paste(qPattern,collapse = "")
subDF<-quarterData(qPattern)
head(subDF)
identical(rownames(subDF),sort(rownames(subDF)))
subDF<-subDF[order(rownames(subDF)),]
head(subDF)
rm(subDF)
Data
runApp()
save.image()
rm(list=ls())
gkg<-gdelt.temp("2015-12-16")
getwd()
setwd("../GDELT Samples")
gkg<-gdelt.temp("2015-12-16")
load(".RData")
gkg<-gdelt.temp("2015-12-16")
sample1<-gkg[sample(1:nrow(gkg),20),]
sampleURLS<-strsplit(as.vector(sample1[,"SOURCEURLS"]),"<UDIV>")
subsetPattern<-""
for(n in 1:length(sampleURLS)){
#   set.seed(1234)
sampleURLS[[n]]<-sample(sampleURLS[[n]],1)
}
for(URL in 1:length(sampleURLS)){
# Sys.sleep(2)
newSample<-tryCatch({htmlToText(sampleURLS[[URL]])},error=function(e){})
if(length(newSample[[1]])==0){newSample<-"cannot read link"}
newSample<-gsub("\\t|\\n|\\r","",newSample[[1]])
newSample<-gsub(" +"," ",newSample)
newSample<-paste(newSample,collapse = ";")
newSample<-(unlist(strsplit(newSample,"[[:punct:]]")))
newSample<-newSample[grepl(".{50}",newSample)]
ifelse(URL==1,
readSample1<-list(newSample),
readSample1<-c(readSample1,list(newSample)))
#   for(m in 2:4){
#     # Sys.sleep(1)
#     print(newSample[seq(1,length(newSample),length.out=5)][m])
#   }
print(c(URL,sampleURLS[[URL]]))
}
names(readSample1)<-unlist(sampleURLS)
if(exists("newsDF")){rm(newsDF)}
for(n in 1:length(readSample1)){
if(0<length(readSample1[[n]])){
DF<-data.frame(matrix(readSample1[[n]][seq(1,length(readSample1[[n]]),length.out=5)],nrow=1))
DF<-cbind(names(readSample1)[n],DF)
colnames(DF)<-c("link","phrase.00","phrase.25","phrase.50","phrase.75","phrase1.0")
if(!identical(DF$phrase.00,DF$phrase1.0)){
ifelse(exists("newsDF"), newsDF <- rbind(DF,newsDF), newsDF<-DF)
}
}
}
for(n in 1:nrow(newsDF)){
for(m in 1:3){
Sys.sleep(2)
print(newsDF[n,c(m+1)])
}
}
for(n in 1:nrow(newsDF)){
for(m in 1:3){
Sys.sleep(2)
print(as.vector(newsDF[n,c(m+1)]))
}
}
newsDF<-cbind(Date=unique(gkg$DATE), Subset=subsetPattern,newsDF)
newsDF0<-read.csv("../GDELT Samples/samples.csv",colClasses = "character")
colnames(newsDF);colnames(newsDF0)
newsDF<-(rbind(newsDF0,newsDF))
rm(newsDF0)
newsDF<-unique(newsDF)
View(newsDF)
write.csv(newsDF,"../GDELT Samples/samples.csv", row.names = F)
for(n in 1:nrow(newsDF)){
Sys.sleep(1)
for(m in 1:5){
Sys.sleep(2)
print(as.vector(newsDF[n,c(m+1)]))
}
}
for(n in 1:nrow(newsDF)){
Sys.sleep(1)
for(m in 1:5){
Sys.sleep(2)
print(as.vector(newsDF[n,c(m+3)]))
}
}
for(n in (nrow(newsDF)-20):nrow(newsDF)){
Sys.sleep(1)
for(m in 1:5){
Sys.sleep(2)
print(as.vector(newsDF[n,c(m+3)]))
}
}
newsDF0<-read.csv("../GDELT Samples/samples.csv",colClasses = "character")
for(n in 1:length(readSample1)){
for(m in 1:length(readSample1)){
Sys.sleep(1)
print(readSample1[[n]][m])
}
}
for(n in 1:length(readSample1)){
for(m in 1:length(readSample1[[n]])){
Sys.sleep(1)
print(readSample1[[n]][m])
}
}
names(readSample1)
rm(DF,gkg,newsDF,newsDF0,sample1)
rm(n,m,newSample,readSample1,sampleURLS,subsetPattern,URL)
getwd()
save.image()
setwd("..")
setwd("census")
list.files)
list.files()
unzip(list.files())
list.files()
list.files(pattern="txt$")
rm(list=ls())
list.files(pattern="txt$")
Sample<-readLines(list.files(pattern="txt$"))
head(Sample)
tail(Sample)
sample(Sample,20)
head(Sample)
setwd("..")
rm(Sample)
setwd("FDIC-Project")
list.files(all.files = T)
load(".RData")
runApp()
open
open("server.R")
